biigle.$declare("largo.api.annotations",Vue.resource("api/v1/annotations{/id}/patch")),biigle.$declare("largo.api.projects",Vue.resource("api/v1/projects{/id}/largo",{},{queryAnnotations:{method:"GET",url:"api/v1/projects{/id}/annotations/filter/label{/label_id}"}})),biigle.$declare("largo.api.volumes",Vue.resource("api/v1/volumes{/id}/largo",{},{queryAnnotations:{method:"GET",url:"api/v1/volumes{/id}/annotations/filter/label{/label_id}"},queryExampleAnnotations:{method:"GET",url:"api/v1/volumes{/id}/annotations/examples{/label_id}"}})),biigle.$component("largo.components.annotationPatch",{props:{id:{type:Number,required:!0},label:{type:Object,required:!0},emptySrc:{type:String,required:!0}},data:function(){return{blobUrl:""}},computed:{title:function(){return"Example annotation for label "+this.label.name},src:function(){return this.blobUrl||this.emptySrc}},methods:{setBlobUrl:function(e){var t=window.URL||window.webkitURL;this.blobUrl=t.createObjectURL(e.body)}},created:function(){biigle.$require("largo.api.annotations").get({id:this.id}).then(this.setBlobUrl)},destroyed:function(){if(this.blobUrl){(window.URL||window.webkitURL).revokeObjectURL(this.blobUrl)}}}),biigle.$require("annotations.components.labelsTabPlugins").exampleAnnotations={mixins:[biigle.$require("core.mixins.loader")],components:{annotationPatch:biigle.$require("largo.components.annotationPatch")},props:{label:{default:null},volumeId:{type:Number,required:!0},count:{type:Number,default:3}},data:function(){return{exampleLabel:null,exampleAnnotations:[],cache:{},shown:!0}},computed:{isShown:function(){return this.shown&&null!==this.label},hasExamples:function(){return this.exampleLabel&&this.exampleAnnotations&&this.exampleAnnotations.length>0},volumesApi:function(){return biigle.$require("largo.api.volumes")}},methods:{parseResponse:function(e){return e.data},setExampleAnnotations:function(e){(!e[0].hasOwnProperty("annotations")||e[0].annotations.length<this.count)&&delete this.cache[e[1]],e[0].hasOwnProperty("label")&&e[0].label.id===e[1]||delete this.cache[e[1]],this.label&&this.label.id===e[1]&&(this.exampleAnnotations=e[0].annotations,this.exampleLabel=e[0].label)},updateShown:function(e){this.shown=e},updateExampleAnnotations:function(){this.exampleAnnotations=[],this.isShown&&(this.startLoading(),this.cache.hasOwnProperty(this.label.id)||(this.cache[this.label.id]=this.volumesApi.queryExampleAnnotations({id:this.volumeId,label_id:this.label.id,take:this.count}).then(this.parseResponse)),Vue.Promise.all([this.cache[this.label.id],this.label.id]).then(this.setExampleAnnotations).finally(this.finishLoading))}},watch:{label:function(){this.updateExampleAnnotations()},shown:function(){this.updateExampleAnnotations()}},created:function(){biigle.$require("events").$on("settings.exampleAnnotations",this.updateShown)}},biigle.$require("annotations.components.settingsTabPlugins").exampleAnnotations={props:{settings:{type:Object,required:!0}},data:function(){return{isShown:!0}},methods:{hide:function(){this.isShown=!1,this.settings.set("exampleAnnotations",!1)},show:function(){this.isShown=!0,this.settings.delete("exampleAnnotations")}},watch:{isShown:function(e){biigle.$require("events").$emit("settings.exampleAnnotations",e)}},created:function(){this.settings.has("exampleAnnotations")&&(this.isShown=this.settings.get("exampleAnnotations"))}};