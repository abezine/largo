biigle.$viewModel("largo-container",function(t){var e=biigle.$require("messages.store"),i=biigle.$require("largo.api.volumes"),s=biigle.$require("largo.volumeId"),n=biigle.$require("largo.stores.events");new Vue({el:t,mixins:[biigle.$require("core.mixins.loader")],components:{labelTrees:biigle.$require("labelTrees.components.labelTrees"),sidebar:biigle.$require("core.components.sidebar"),sidebarTab:biigle.$require("core.components.sidebarTab"),imageGrid:biigle.$require("largo.components.imageGrid")},data:{labelTrees:biigle.$require("largo.labelTrees"),step:0,selectedLabel:null,annotationsCache:{}},computed:{isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step},annotations:function(){return this.selectedLabel&&this.annotationsCache.hasOwnProperty(this.selectedLabel.id)?this.annotationsCache[this.selectedLabel.id]:[]}},methods:{getAnnotations:function(t){if(!this.annotationsCache.hasOwnProperty(t.id)){var n=this;Vue.set(n.annotationsCache,t.id,[]),this.startLoading(),i.queryAnnotations({id:s,label_id:t.id}).then(function(e){Vue.set(n.annotationsCache,t.id,e.data)},e.handleResponseError).finally(this.finishLoading)}},handleSelectedLabel:function(t){this.selectedLabel=t,this.isInDismissStep&&this.getAnnotations(t)},handleDeselectedLabel:function(){this.selectedLabel=null}},watch:{annotations:function(t){n.$emit("annotations-count",t.length)},step:function(t){n.$emit("step",t)}},created:function(){}})}),biigle.$viewModel("largo-title",function(t){var e=biigle.$require("largo.stores.events");new Vue({el:t,data:{step:0,count:0},methods:{isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step},updateStep:function(t){this.step=t},updateCount:function(t){this.count=t}},created:function(){e.$on("annotations-count",this.updateCount),e.$on("step",this.updateStep)}})}),biigle.$declare("largo.api.annotations",Vue.resource("api/v1/annotations{/id}/patch")),biigle.$declare("largo.api.volumes",Vue.resource("api/v1/volumes{/id}/largo",{},{queryAnnotations:{method:"GET",url:"api/v1/volumes{/id}/annotations/filter/label{/label_id}"}})),biigle.$declare("largo.stores.blobs",{}),biigle.$declare("largo.stores.events",new Vue),biigle.$component("largo.components.imageGrid",{template:'<div class="image-grid"><div class="image-grid__images" ref="images"><image-grid-image v-for="id in displayedImages" :key="id" :id="id" :empty-url="emptyUrl"></image-grid-image></div><image-grid-progress :progress="progress" @top="jumpToStart" @prev-page="reversePage" @prev-row="reverseRow" @jump="jumpToPercent" @next-row="advanceRow" @next-page="advancePage" @bottom="jumpToEnd"></image-grid-progress></div>',data:function(){return{clientWidth:0,clientHeight:0,privateOffset:0}},components:{imageGridImage:biigle.$require("largo.components.imageGridImage"),imageGridProgress:biigle.$require("largo.components.imageGridProgress")},props:{images:{type:Array,required:!0},emptyUrl:{type:String,required:!0},width:{type:Number,default:135},height:{type:Number,default:180},margin:{type:Number,default:8}},computed:{columns:function(){return Math.floor(this.clientWidth/(this.width+this.margin))},rows:function(){return Math.floor(this.clientHeight/(this.height+this.margin))},displayedImages:function(){return this.images.slice(this.offset,this.offset+this.columns*this.rows)},offset:{get:function(){return this.privateOffset},set:function(t){this.privateOffset=Math.max(0,Math.min(this.lastRow*this.columns,t))}},progress:function(){return this.offset/(this.columns*this.lastRow)},lastRow:function(){return Math.ceil(this.images.length/this.columns)-this.rows}},methods:{updateDimensions:function(){this.clientHeight=this.$refs.images.clientHeight,this.clientWidth=this.$refs.images.clientWidth},scrollRows:function(t){this.offset=this.offset+this.columns*t},scroll:function(t){this.scrollRows(t.deltaY>=0?1:-1)},advanceRow:function(){this.scrollRows(1)},advancePage:function(){this.scrollRows(this.rows)},reverseRow:function(){this.scrollRows(-1)},reversePage:function(){this.scrollRows(-this.rows)},jumpToPercent:function(t){this.offset=this.columns*Math.round(this.lastRow*t)},jumpToStart:function(){this.jumpToPercent(0)},jumpToEnd:function(){this.jumpToPercent(1)}},created:function(){window.addEventListener("resize",this.updateDimensions)},mounted:function(){this.updateDimensions(),this.$el.addEventListener("wheel",this.scroll)}}),biigle.$component("largo.components.imageGridImage",{template:'<figure class="image-grid__image"><img :src="url || emptyUrl"></figure>',data:function(){return{url:"",timeout:null}},props:{id:{required:!0},emptyUrl:{type:String,required:!0}},computed:{},methods:{requestBlob:function(){return biigle.$require("largo.api.annotations").get({id:this.id})}},created:function(){var t=biigle.$require("largo.stores.blobs");if(t.hasOwnProperty(this.id))this.url=t[this.id];else{var e=this;this.timeout=setTimeout(function(){e.requestBlob().then(function(i){var s=window.URL||window.webkitURL;e.url=s.createObjectURL(i.body),t[e.id]=e.url})},50)}},beforeDestroy:function(){clearTimeout(this.timeout)}}),biigle.$component("largo.components.imageGridProgress",{template:'<div class="image-grid-progress"><div class="btn-group-vertical"><button type="button" class="btn btn-default btn-xs" title="Go to top 𝗛𝗼𝗺𝗲" @click="top" :disabled="isAtTop"><span class="glyphicon glyphicon-fast-backward"></span></button><button type="button" class="btn btn-default btn-xs" title="Previous page 𝗣𝗮𝗴𝗲 𝘂𝗽/𝗔𝗿𝗿𝗼𝘄 𝗹𝗲𝗳𝘁" @click="prevPage" :disabled="isAtTop"><span class="glyphicon glyphicon-step-backward"></span></button><button type="button" class="btn btn-default btn-xs" title="Previous row 𝗔𝗿𝗿𝗼𝘄 𝘂𝗽" @click="prevRow" :disabled="isAtTop"><span class="glyphicon glyphicon-triangle-left"></span></button></div><div class="image-grid-progress__bar" @mousedown="beginScrolling" @mouseup="stopScrolling" @mouseleave="stopScrolling" @mousemove.prevent="scroll" @click="jump"><div class="image-grid-progress__wrapper"><div class="image-grid-progress__inner" :style="{height: progressHeight}"></div></div></div><div class="btn-group-vertical"><button type="button" class="btn btn-default btn-xs" title="Next row 𝗔𝗿𝗿𝗼𝘄 𝗱𝗼𝘄𝗻" @click="nextRow" :disabled="isAtBottom"><span class="glyphicon glyphicon-triangle-right"></span></button><button type="button" class="btn btn-default btn-xs" title="Next page 𝗣𝗮𝗴𝗲 𝗱𝗼𝘄𝗻/𝗔𝗿𝗿𝗼𝘄 𝗿𝗶𝗴𝗵𝘁" @click="nextPage" :disabled="isAtBottom"><span class="glyphicon glyphicon-step-forward"></span></button><button type="button" class="btn btn-default btn-xs" title="Go to bottom 𝗘𝗻𝗱" @click="bottom" :disabled="isAtBottom"><span class="glyphicon glyphicon-fast-forward"></span></button></div></div>',data:function(){return{scrolling:!1}},props:{progress:{type:Number,required:!0}},computed:{isAtTop:function(){return 0===this.progress},isAtBottom:function(){return 1===this.progress},progressHeight:function(){return 100*this.progress+"%"}},methods:{top:function(){this.$emit("top")},prevPage:function(){this.$emit("prev-page")},prevRow:function(){this.$emit("prev-row")},beginScrolling:function(){this.scrolling=!0},stopScrolling:function(){this.scrolling=!1},scroll:function(t){this.scrolling&&this.jump(t)},jump:function(t){var e=t.target.getBoundingClientRect();this.$emit("jump",(t.clientY-e.top)/e.height)},nextRow:function(){this.$emit("next-row")},nextPage:function(){this.$emit("next-page")},bottom:function(){this.$emit("bottom")}}});