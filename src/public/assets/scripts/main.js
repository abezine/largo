angular.module("dias.ate",["dias.transects"]),angular.module("dias.ate").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.ate").controller("AteController",["$scope",function(e){"use strict";var n=!0;e.isInLabelMode=function(){return n}}]),angular.module("dias.ate").service("labels",["LABEL_TREES","USER_ID","IS_ADMIN","AnnotationLabel","$q",function(e,n,t,i,r){"use strict";var a={},o=[],u={},s=[],l=null,c=function(){for(var n,t=function(e){var t=e.parent_id;u[n][t]?u[n][t].push(e):u[n][t]=[e]},i=e.length-1;i>=0;i--)n=e[i].name,u[n]={},e[i].labels.forEach(t),o=o.concat(e[i].labels)},d=function(e){for(var n=o.length-1;n>=0;n--)if(o[n].id===e)return o[n];return null},f=function(e){var n=e;if(s.length=0,n)for(;null!==n.parent_id;)s.unshift(n.parent_id),n=d(n.parent_id)},h=function(e,n){a.hasOwnProperty(e)&&a[e].unshift(n)},p=function(e,n){if(a.hasOwnProperty(e))for(var t=a[e],i=t.length-1;i>=0;i--)if(t[i].id===n.id){t.splice(i,1);break}},b=function(e,n){a.hasOwnProperty(e)&&a[e].push(n)};this.getLabels=function(){return o},this.getLabelTrees=function(){return u},this.selectLabel=function(e){f(e),l=e},this.treeItemIsOpen=function(e){return-1!==s.indexOf(e.id)},this.treeItemIsSelected=function(e){return l&&l.id===e.id},this.attachToImage=function(e){if(l)return i.attach({label_id:l.id,confidence:1,annotation_id:e},function(n){h(e,n)}).$promise;var n=r.defer();return n.reject({data:{message:"No label selected."}}),n.promise},this.getAttachedLabels=function(e){return a.hasOwnProperty(e)||(a[e]=i.query({annotation_id:e})),a[e]},this.canDetachLabel=function(e){return t||e.user.id===n},this.detachLabel=function(e,n){return p(e,n),i["delete"]({id:n.id},angular.noop,function(){b(e,n)}).$promise},c()}]);