!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}({0:function(e,t,n){n("WfG0"),e.exports=n("zcrr")},WfG0:function(e,t,n){"use strict";n.r(t);var i={computed:{patchPrefix:function(){return this.uuid[0]+this.uuid[1]+"/"+this.uuid[2]+this.uuid[3]+"/"+this.uuid}},methods:{getUrl:function(){return this.urlTemplate.replace(":prefix",this.patchPrefix).replace(":id",this.id)}}},s={mixins:[i],props:{id:{type:String,required:!0},uuid:{type:String,required:!0},label:{type:Object,required:!0},emptySrc:{type:String,required:!0},urlTemplate:{type:String,required:!0}},data:function(){return{url:""}},computed:{title:function(){return"Example annotation for label "+this.label.name},src:function(){return this.url||this.emptySrc}},methods:{showEmptyImage:function(){this.url=""}},created:function(){this.url=this.getUrl()}},a=Vue.resource("api/v1/volumes{/id}/largo",{},{queryAnnotations:{method:"GET",url:"api/v1/volumes{/id}/annotations/filter/label{/label_id}"},queryExampleAnnotations:{method:"GET",url:"api/v1/volumes{/id}/annotations/examples{/label_id}"}}),o=biigle.$require("events"),l=biigle.$require("messages").handleErrorResponse,r=biigle.$require("volumes.components.imageGrid"),u=biigle.$require("volumes.components.imageGridImage"),h=biigle.$require("annotations.components.labelsTabPlugins"),c=biigle.$require("labelTrees.components.labelTrees"),d=biigle.$require("core.mixins.loader"),m=biigle.$require("messages"),g=biigle.$require("core.components.powerToggle"),f=biigle.$require("annotations.components.settingsTabPlugins"),p=biigle.$require("core.components.sidebar"),b=biigle.$require("core.components.sidebarTab");h&&(h.exampleAnnotations={mixins:[d],components:{annotationPatch:s},props:{label:{default:null},volumeId:{type:Number,required:!0},count:{type:Number,default:3}},data:function(){return{exampleLabel:null,exampleAnnotations:[],cache:{},shown:!0}},computed:{isShown:function(){return this.shown&&null!==this.label},hasExamples:function(){return this.exampleLabel&&this.exampleAnnotations&&Object.keys(this.exampleAnnotations).length>0}},methods:{parseResponse:function(e){return e.data},setExampleAnnotations:function(e){(!e[0].hasOwnProperty("annotations")||Object.keys(e[0].annotations).length<this.count)&&delete this.cache[e[1]],e[0].hasOwnProperty("label")&&e[0].label.id===e[1]||delete this.cache[e[1]],this.label&&this.label.id===e[1]&&(this.exampleAnnotations=e[0].annotations,this.exampleLabel=e[0].label)},updateShown:function(e){this.shown=e},updateExampleAnnotations:function(){this.exampleAnnotations=[],this.isShown&&(this.startLoading(),this.cache.hasOwnProperty(this.label.id)||(this.cache[this.label.id]=a.queryExampleAnnotations({id:this.volumeId,label_id:this.label.id,take:this.count}).then(this.parseResponse)),Vue.Promise.all([this.cache[this.label.id],this.label.id]).then(this.setExampleAnnotations).finally(this.finishLoading))}},watch:{label:function(){this.updateExampleAnnotations()},shown:function(){this.updateExampleAnnotations()}},created:function(){o.$on("settings.exampleAnnotations",this.updateShown)}}),f&&(f.exampleAnnotations={components:{powerButton:g},props:{settings:{type:Object,required:!0}},data:function(){return{isShown:!0}},methods:{hide:function(){this.isShown=!1,this.settings.set("exampleAnnotations",!1)},show:function(){this.isShown=!0,this.settings.delete("exampleAnnotations")}},watch:{isShown:function(e){o.$emit("settings.exampleAnnotations",e)}},created:function(){this.settings.has("exampleAnnotations")&&(this.isShown=this.settings.get("exampleAnnotations"))}}),biigle.$declare("largo.mixins.annotationPatch",i);var w={mixins:[r],components:{imageGridImage:{mixins:[u,i],template:'<figure class="image-grid__image image-grid__image--catalog" :class="classObject">\n        <a v-if="showAnnotationLink" :href="showAnnotationLink" target="_blank" title="Show the annotation in the annotation tool">\n            <img :src="url || emptyUrl" @error="showEmptyImage">\n        </a>\n        <img v-else :src="url || emptyUrl" @error="showEmptyImage">\n    </figure>',data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""},id:function(){return this.image.id},uuid:function(){return this.image.uuid},urlTemplate:function(){return biigle.$require("largo.patchUrlTemplate")}},created:function(){this.showAnnotationRoute=biigle.$require("annotationCatalog.showAnnotationRoute")}}}},A=Vue.resource("api/v1/labels{/id}/annotations",{},{queryAnnotations:{method:"GET"}}),v={mixins:[d],components:{labelTrees:c,sidebar:p,sidebarTab:b,powerToggle:g,dismissImageGrid:{mixins:[r],components:{imageGridImage:{mixins:[u,i],template:'<figure class="image-grid__image" :class="classObject" :title="title">\n        <div v-if="selectable" class="image-icon">\n            <i class="fas" :class="iconClass"></i>\n        </div>\n        <img @click="toggleSelect" :src="url || emptyUrl" @error="showEmptyImage">\n        <div v-if="showAnnotationLink" class="image-buttons">\n            <a :href="showAnnotationLink" target="_blank" class="image-button" title="Show the annotation in the annotation tool">\n                <span class="fa fa-external-link-square-alt" aria-hidden="true"></span>\n            </a>\n        </div>\n    </figure>',data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""},selected:function(){return this.image.dismissed},title:function(){return this.selected?"Undo dismissing this annotation":"Dismiss this annotation"},id:function(){return this.image.id},uuid:function(){return this.image.uuid},urlTemplate:function(){return biigle.$require("largo.patchUrlTemplate")}},created:function(){this.showAnnotationRoute=biigle.$require("largo.showAnnotationRoute")}}}},relabelImageGrid:{mixins:[r],components:{imageGridImage:{mixins:[u,i],template:'<figure class="image-grid__image image-grid__image--relabel" :class="classObject" :title="title">\n        <div v-if="selectable" class="image-icon">\n            <i class="fas" :class="iconClass"></i>\n        </div>\n        <img @click="toggleSelect" :src="url || emptyUrl" @error="showEmptyImage">\n        <div v-if="showAnnotationLink" class="image-buttons">\n            <a :href="showAnnotationLink" target="_blank" class="image-button" title="Show the annotation in the annotation tool">\n                <span class="fa fa-external-link-square-alt" aria-hidden="true"></span>\n            </a>\n        </div>\n        <div v-if="selected" class="new-label">\n            <span class="new-label__color" :style="newLabelStyle"></span>\n            <span class="new-label__name" v-text="image.newLabel.name"></span>\n        </div>\n    </figure>',data:function(){return{showAnnotationRoute:null}},computed:{showAnnotationLink:function(){return this.showAnnotationRoute?this.showAnnotationRoute+this.image.id:""},selected:function(){return this.image.newLabel},title:function(){return this.selected?"Revert changing the label of this annotation":"Change the label of this annotation"},newLabelStyle:function(){return{"background-color":"#"+this.image.newLabel.color}},id:function(){return this.image.id},uuid:function(){return this.image.uuid},urlTemplate:function(){return biigle.$require("largo.patchUrlTemplate")}},created:function(){this.showAnnotationRoute=biigle.$require("largo.showAnnotationRoute")}}}}},data:{labelTrees:[],step:0,selectedLabel:null,annotationsCache:{},lastSelectedImage:null,forceChange:!1},computed:{isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step},annotations:function(){return this.selectedLabel&&this.annotationsCache.hasOwnProperty(this.selectedLabel.id)?this.annotationsCache[this.selectedLabel.id]:[]},allAnnotations:function(){var e=[];for(var t in this.annotationsCache)this.annotationsCache.hasOwnProperty(t)&&Array.prototype.push.apply(e,this.annotationsCache[t]);return e},hasNoAnnotations:function(){return this.selectedLabel&&!this.loading&&0===this.annotations.length},dismissedAnnotations:function(){return this.allAnnotations.filter((function(e){return e.dismissed}))},annotationsWithNewLabel:function(){return this.dismissedAnnotations.filter((function(e){return!!e.newLabel}))},hasDismissedAnnotations:function(){return this.dismissedAnnotations.length>0},dismissedToSave:function(){for(var e=this.dismissedAnnotations,t={},n=e.length-1;n>=0;n--)t.hasOwnProperty(e[n].label_id)?t[e[n].label_id].push(e[n].id):t[e[n].label_id]=[e[n].id];return t},changedToSave:function(){for(var e=this.annotationsWithNewLabel,t={},n=e.length-1;n>=0;n--)t.hasOwnProperty(e[n].newLabel.id)?t[e[n].newLabel.id].push(e[n].id):t[e[n].newLabel.id]=[e[n].id];return t},toDeleteCount:function(){return this.dismissedAnnotations.length-this.annotationsWithNewLabel.length},saveButtonClass:function(){return this.forceChange?"btn-danger":"btn-success"}},methods:{getAnnotations:function(e){var t=this;this.annotationsCache.hasOwnProperty(e.id)||(Vue.set(this.annotationsCache,e.id,[]),this.startLoading(),this.queryAnnotations(e).then((function(n){return t.gotAnnotations(e,n.data)}),l).finally(this.finishLoading))},gotAnnotations:function(e,t){t=Object.keys(t).map((function(n){return{id:n,uuid:t[n],label_id:e.id,dismissed:!1,newLabel:null}})).sort((function(e,t){return t.id-e.id})),Vue.set(this.annotationsCache,e.id,t)},handleSelectedLabel:function(e){this.selectedLabel=e,this.isInDismissStep&&this.getAnnotations(e)},handleDeselectedLabel:function(){this.selectedLabel=null},handleSelectedImageDismiss:function(e,t){e.dismissed?(e.dismissed=!1,e.newLabel=null):(e.dismissed=!0,t.shiftKey&&this.lastSelectedImage?this.dismissAllImagesBetween(e,this.lastSelectedImage):this.lastSelectedImage=e)},goToRelabel:function(){this.step=1,this.lastSelectedImage=null},goToDismiss:function(){this.step=0,this.lastSelectedImage=null,this.selectedLabel&&this.getAnnotations(this.selectedLabel)},handleSelectedImageRelabel:function(e,t){e.newLabel?this.selectedLabel&&e.newLabel.id!==this.selectedLabel.id?e.newLabel=this.selectedLabel:e.newLabel=null:this.selectedLabel&&(e.newLabel=this.selectedLabel,t.shiftKey&&this.lastSelectedImage?this.relabelAllImagesBetween(e,this.lastSelectedImage):this.lastSelectedImage=e)},save:function(){this.loading||this.toDeleteCount>0&&!confirm("This might delete ".concat(this.toDeleteCount," annotation(s). Continue?"))||(this.startLoading(),this.performSave({dismissed:this.dismissedToSave,changed:this.changedToSave,force:this.forceChange}).then(this.saved,l).finally(this.finishLoading))},saved:function(){for(var e in m.success("Saved. You can now start a new re-evaluation session."),this.step=0,this.annotationsCache)this.annotationsCache.hasOwnProperty(e)&&delete this.annotationsCache[e];this.handleSelectedLabel(this.selectedLabel)},performOnAllImagesBetween:function(e,t,n){var i=this.allAnnotations.indexOf(e),s=this.allAnnotations.indexOf(t);if(s<i){var a=s;s=i,i=a}for(var o=i+1;o<s;o++)n(this.allAnnotations[o])},dismissAllImagesBetween:function(e,t){this.performOnAllImagesBetween(e,t,(function(e){e.dismissed=!0}))},relabelAllImagesBetween:function(e,t){var n=this.selectedLabel;this.performOnAllImagesBetween(e,t,(function(e){e.dismissed&&(e.newLabel=n)}))},enableForceChange:function(){this.forceChange=!0},disableForceChange:function(){this.forceChange=!1}},watch:{annotations:function(e){o.$emit("annotations-count",e.length)},dismissedAnnotations:function(e){o.$emit("dismissed-annotations-count",e.length)},step:function(e){o.$emit("step",e)},selectedLabel:function(){this.isInDismissStep&&this.$refs.dismissGrid.setOffset(0)}},created:function(){var e=this;window.addEventListener("beforeunload",(function(t){if(e.hasDismissedAnnotations)return t.preventDefault(),t.returnValue="","This page is asking you to confirm that you want to leave - data you have entered may not be saved."}))}},y={mixins:[v],components:{catalogImageGrid:w},data:{labelTrees:[]},methods:{queryAnnotations:function(e){return A.queryAnnotations({id:e.id})}},created:function(){var e=biigle.$require("annotationCatalog.labelTree");this.labelTrees=[e]}},L={mixins:[v],data:{volumeId:null,labelTrees:[]},methods:{queryAnnotations:function(e){return a.queryAnnotations({id:this.volumeId,label_id:e.id})},performSave:function(e){return a.save({id:this.volumeId},e)}},created:function(){this.volumeId=biigle.$require("largo.volumeId"),this.labelTrees=biigle.$require("largo.labelTrees")}},S={data:{step:0,count:0,dismissedCount:0},computed:{shownCount:function(){return this.isInDismissStep?this.count:this.dismissedCount},isInDismissStep:function(){return 0===this.step},isInRelabelStep:function(){return 1===this.step}},methods:{updateStep:function(e){this.step=e},updateCount:function(e){this.count=e},updateDismissedCount:function(e){this.dismissedCount=e}},created:function(){o.$on("annotations-count",this.updateCount),o.$on("dismissed-annotations-count",this.updateDismissedCount),o.$on("step",this.updateStep)}},x=Vue.resource("api/v1/projects{/id}/largo",{},{queryAnnotations:{method:"GET",url:"api/v1/projects{/id}/annotations/filter/label{/label_id}"}}),I={mixins:[v],data:{projectId:null,labelTrees:[]},methods:{queryAnnotations:function(e){return x.queryAnnotations({id:this.projectId,label_id:e.id})},performSave:function(e){return x.save({id:this.projectId},e)}},created:function(){this.projectId=biigle.$require("largo.projectId"),this.labelTrees=biigle.$require("largo.labelTrees")}};biigle.$mount("annotation-catalog-container",y),biigle.$mount("largo-container",L),biigle.$mount("largo-title",S),biigle.$mount("project-largo-container",I)},zcrr:function(e,t){}});