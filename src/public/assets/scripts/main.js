angular.module("dias.ate",["dias.transects"]),angular.module("dias.ate").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.ate").controller("AteController",["$scope","labels","annotations",function(e,t,n){"use strict";var i=0,s={DISMISS:0,RELABEL:1},a=function(){document.getElementById("dismiss-mode-title").classList.toggle("ng-hide"),document.getElementById("re-labelling-mode-title").classList.toggle("ng-hide")};e.annotationsExist=n.exist,e.isInDismissMode=function(){return i===s.DISMISS},e.goToDismiss=function(){i=s.DISMISS,a(),n.goToStep(i)},e.isInReLabellingMode=function(){return i===s.RELABEL},e.goToReLabelling=function(){i=s.RELABEL,a(),n.goToStep(i)},e.hasSelectedLabel=t.hasSelectedLabel,e.getSelectedLabelName=function(){return t.getSelectedLabel().name},e.isLoading=n.isLoading,e.getClass=function(){return{"dismiss-mode":e.isInDismissMode(),"re-labelling-mode":e.isInReLabellingMode()}},e.$watch(t.getSelectedLabel,n.handleSelectedLabel)}]),angular.module("dias.ate").directive("ateFigure",function(){"use strict";return{restrict:"A",controller:["$scope","annotations","msg",function(e,t,n){e.handleClick=function(n){t.selectAnnotation(e.id)};var i=function(){return t.isDismissed(e.id)},s=function(){return t.isChanged(e.id)};e.getTitle=function(){return e.isInDismissMode()?i()?"Undo dismissing this annotation":"Dismiss this annotation":s()?"Revert changing the label of this annotation":"Change the label of this annotation"},e.getClass=function(){return{"annotation-selected":e.isInDismissMode()&&i()||e.isInReLabellingMode()&&s()}}}]}}),angular.module("dias.ate").factory("TransectFilterAnnotationLabel",["$resource","URL",function(e,t){"use strict";return e(t+"/api/v1/transects/:transect_id/annotations/filter/label/:label_id")}]),angular.module("dias.ate").service("annotations",["ATE_TRANSECT_ID","TRANSECT_IMAGES","TransectFilterAnnotationLabel","labels","images","msg",function(e,t,n,i,s,a){"use strict";var o={},l=!1,r=!1,u={},c=[],d={},g=0,f={DISMISS:0,RELABEL:1},h=this,L=function(e){-1===c.indexOf(e)&&c.push(e)},S=function(e){var t=c.indexOf(e);-1!==t&&c.splice(t,1),d.hasOwnProperty(e)&&delete d[e]},b=function(e){r=!1,l=e.length>0,l&&Array.prototype.push.apply(t,e),s.updateFiltering()},p=function(e){var t=i.getSelectedLabel().id;if(u.hasOwnProperty(t)){var n=u[t].indexOf(e);-1!==n?(u[t].splice(n,1),S(e)):(u[t].push(e),L(e))}else u[t]=[e],L(e)},m=function(e){d.hasOwnProperty(e)?delete d[e]:d[e]=i.getSelectedLabel().id},I=function(){t.length=0,l=c.length>0,l&&Array.prototype.push.apply(t,c),s.scrollToPercent(0),s.updateFiltering()};this.selectAnnotation=function(e){g===f.DISMISS?p(e):m(e)},this.isDismissed=function(e){var t=i.getSelectedLabel().id;return u.hasOwnProperty(t)&&-1!==u[t].indexOf(e)},this.getDismissedIds=function(){return c},this.isChanged=function(e){return d.hasOwnProperty(e)},this.handleSelectedLabel=function(i){if(i&&g!==f.RELABEL){var l=i.id;t.length=0,s.updateFiltering(),s.scrollToPercent(0),o.hasOwnProperty(l)?b(o[l]):(r=!0,o[l]=n.query({transect_id:e,label_id:l},b,a.responseError))}},this.exist=function(){return l},this.isLoading=function(){return r},this.goToStep=function(e){g=e,g===f.DISMISS?h.handleSelectedLabel(i.getSelectedLabel()):I()}}]),angular.module("dias.ate").service("labels",["LABEL_TREES",function(e){"use strict";var t=[],n={},i=[],s=null,a=function(){for(var i,s=function(e){var t=e.parent_id;n[i][t]?n[i][t].push(e):n[i][t]=[e]},a=e.length-1;a>=0;a--)i=e[a].name,n[i]={},e[a].labels.forEach(s),t=t.concat(e[a].labels)},o=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e)return t[n];return null},l=function(e){var t=e;if(i.length=0,t)for(;null!==t.parent_id;)i.unshift(t.parent_id),t=o(t.parent_id)};this.getLabels=function(){return t},this.getLabelTrees=function(){return n},this.selectLabel=function(e){l(e),s=e},this.treeItemIsOpen=function(e){return-1!==i.indexOf(e.id)},this.treeItemIsSelected=function(e){return s&&s.id===e.id},this.getSelectedLabel=function(){return s},this.hasSelectedLabel=function(){return null!==s},a()}]);